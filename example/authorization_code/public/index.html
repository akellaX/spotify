<!doctype html>
<html>
    <script>
        window.open('http://egeshki.ru/spotify/');
    </script>
  <head>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

  </head>

  <body>
    <div id="search_class" >
      <p>Song name</p>
      <input id="str_search" type="text" value="" >
      <p>Artist name</p>
      <p><input id="str_artist" type="text" value="" ></p>
      <button class="btn btn-success" id="search">Search</button>

      <p id="search_info"></p>
      <p id="to_add"><img id="search_img">
	  <button id="next_" value="0" hidden="true" >next</button>
	  </p>
      <audio id="search_audio" controls style="display: none;"></audio>
      </div>



    <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script id="get_token">
    var access_token;
    var  refresh_token;
    function jsonpObtainer(data){
    var temp=JSON.parse(data);
    access_token = temp.token;
    refresh_token = temp.refreshToken;
    console.log(temp.token);
    console.log(temp.refreshToken);
    };
    $.ajax({
      dataType: "jsonp",
      crossDomain : true,
      url: "http://egeshki.ru/spotify/",
      success: function(response){
      jsonpObtainer(response);
      },
      error: function(response){
      console.log(response);
      }
    });
          </script>

    <script id="acc_inf">
                      $.ajax({
                url: 'https://api.spotify.com/v1/me',
                headers: {
                  'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                    console.log("inf"+response);
                }
            });



    </script>

    <script>
      (function() {
//          window.open('http://egeshki.ru/spotify/');

        /**
         * Obtains parameters from the hash of the URL
         * @return Object
         */












		var tracks_arr;

		function next_track (value){
			if (tracks_arr.length>value){
			console.log(value);
			var next_val=Number(value)+1;
			$("#next_").val(next_val);
			console.log($("#next_").val());
			$("#search_audio").src=tracks_arr[next_val].preview_url;
            $("#search_info").html(tracks_arr[next_val].name+" by "+tracks_arr[next_val].artists[0].name);
            $("#search_img").src=tracks_arr[next_val].album.images[1].url;

			}
		}

                  console.log("token:"+access_token);



    document.getElementById('search').addEventListener('click', function() {
        var query=$("#str_search").val();
                          console.log("token:"+access_token);

        var artist_str=$("#str_artist").val();
      if(artist_str)
      query += ' artist:' + artist_str;


                $.ajax({
            url: 'https://api.spotify.com/v1/search',
                                    headers: {
                  'Authorization': 'Bearer ' + access_token
                },
            data: {
                q: query,
                type: 'track'
            },
            success: function (response) {
                if (response.tracks.items.length) {
				tracks_arr=response.tracks.items;
				console.log(tracks_arr);
				$("#next_").show();
				$("#next_").val("0");
				$("#next_").off("click");
				$("#next_").click(function(){
				var value=Number($("#next_").val());
			if (tracks_arr.length-1>value){
			console.log(value);
			var next_val=value+1;
			$("#next_").val(next_val);
			console.log($("#next_").val());
			$("#search_audio").attr("src",tracks_arr[next_val].preview_url);
            $("#search_info").html(tracks_arr[next_val].name+" by "+tracks_arr[next_val].artists[0].name);
            $("#search_img").attr("src",tracks_arr[next_val].album.images[1].url);
			}
			else alert ("no more tracks:(((");
		})
                    var track = response.tracks.items[0];
					console.log(response);
                    console.log(track);
                  document.getElementById("search_audio").style.display = 'block';
                  document.getElementById("search_audio").src=track.preview_url;
                  document.getElementById("search_info").innerHTML=track.name+" by "+track.artists[0].name;
                  if(track.album.images[1].url)
                  document.getElementById("search_img").src=track.album.images[1].url;
                  if(track.preview_url===null)
                    alert("Sorry we don't have preview for this track :(");
                }
            }
        });

;
          }, false);


      })();
    </script>
  </body>
</html>

